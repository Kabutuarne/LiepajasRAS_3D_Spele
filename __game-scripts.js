var Vehicle=pc.createScript("vehicle");Vehicle.attributes.add("speed",{type:"number",default:120}),Vehicle.attributes.add("turnSpeed",{type:"number",default:.1}),Vehicle.attributes.add("minTurnVelocity",{type:"number",default:.5}),Vehicle.attributes.add("maxTurnVelocity",{type:"number",default:1}),Vehicle.attributes.add("baseEntity",{type:"entity"}),Vehicle.attributes.add("chaseEntity",{type:"entity"}),Vehicle.attributes.add("wheels",{type:"entity",array:!0}),Vehicle.attributes.add("turnTorqueFactor",{type:"number",default:60}),Vehicle.attributes.add("tireGrip",{type:"number",default:6}),Vehicle.attributes.add("brakeFactor",{type:"number",default:.5}),Vehicle.attributes.add("rbMass",{type:"number",default:150}),Vehicle.attributes.add("rbLinearDamping",{type:"number",default:.6}),Vehicle.attributes.add("rbAngularDamping",{type:"number",default:1.2}),Vehicle.attributes.add("rbCenterOfMassY",{type:"number",default:-.4}),Vehicle.attributes.add("groundRayLength",{type:"number",default:1.5,title:"Ground Ray Length"}),Vehicle.attributes.add("groundRayOffsetY",{type:"number",default:.5,title:"Ray Start Offset Y"}),Vehicle.attributes.add("normalLerp",{type:"number",default:.25,title:"Normal Smoothing 0..1"}),Vehicle.attributes.add("extraDownforce",{type:"number",default:2,title:"Extra Downforce (x mass)"}),Vehicle.attributes.add("stepCheckDistance",{type:"number",default:1,title:"Step Check Ahead Distance"}),Vehicle.attributes.add("stepMaxHeight",{type:"number",default:.25,title:"Step Max Height"}),Vehicle.attributes.add("stepImpulse",{type:"number",default:80,title:"Step Up Impulse"}),Vehicle.attributes.add("driveWhenAirborne",{type:"boolean",default:!0,title:"Allow Airborne Drive"}),Vehicle.attributes.add("engineSoundEntity",{type:"entity",title:"Engine Sound Entity",description:"Entity with Sound component (defaults to baseEntity if empty)"}),Vehicle.attributes.add("engineLoopSlot",{type:"string",default:"engine",title:"Engine Loop Slot"}),Vehicle.attributes.add("accelSlot",{type:"string",default:"",title:"Accel One-Shot Slot"}),Vehicle.attributes.add("decelSlot",{type:"string",default:"",title:"Decel One-Shot Slot"}),Vehicle.attributes.add("accelSensitivity",{type:"number",default:.5,title:"Accel Threshold"}),Vehicle.attributes.add("minEnginePitch",{type:"number",default:.8,title:"Min Engine Pitch"}),Vehicle.attributes.add("maxEnginePitch",{type:"number",default:1.6,title:"Max Engine Pitch"}),Vehicle.attributes.add("maxEngineSpeed",{type:"number",default:25,title:"Speed At Max Pitch"}),Vehicle.prototype.initialize=function(){if(this.baseEntity||(this.baseEntity=this.entity),this.rb=this.baseEntity&&this.baseEntity.rigidbody?this.baseEntity.rigidbody:null,this.rb){try{this.rb.mass=this.rbMass,this.rb.linearDamping=this.rbLinearDamping,this.rb.angularDamping=this.rbAngularDamping,void 0!==this.rb.centerOfMass&&(this.rb.centerOfMass=new pc.Vec3(0,this.rbCenterOfMassY,0))}catch(t){}if(this._origLinDamping=this.rb.linearDamping,this._origAngDamping=this.rb.angularDamping,this.currentTurnSpeed=0,this.prevSpeed=0,this.controlsEnabled=!0,this._tmpA=new pc.Vec3,this._tmpB=new pc.Vec3,this._tmpC=new pc.Vec3,this._groundNormal=new pc.Vec3(0,1,0),this._haveGround=!1,this._engineSoundEntity=this.engineSoundEntity||this.baseEntity,this._sound=this._engineSoundEntity&&this._engineSoundEntity.sound?this._engineSoundEntity.sound:null,this._sound&&this.engineLoopSlot){var t=this._sound.slot(this.engineLoopSlot);t&&(t.loop=!0,t.isPlaying||t.play())}this.app.on("player:lockControls",this.lockControls,this),this.app.on("player:unlockControls",this.unlockControls,this)}else console.warn("Vehicle script: baseEntity has no rigidbody. Driving will not work.")},Vehicle.prototype.onDestroy=function(){this.app.off("player:lockControls",this.lockControls,this),this.app.off("player:unlockControls",this.unlockControls,this)},Vehicle.prototype.lockControls=function(){this.controlsEnabled=!1,this.rb&&(this.rb.linearVelocity&&this.rb.linearVelocity.set(0,0,0),this.rb.angularVelocity&&this.rb.angularVelocity.set(0,0,0),this.rb.linearDamping=10,this.rb.angularDamping=10)},Vehicle.prototype.unlockControls=function(){this.controlsEnabled=!0,this.rb&&(this.rb.linearDamping=this._origLinDamping,this.rb.angularDamping=this._origAngDamping)},Vehicle.prototype._raycastGround=function(){var t=this.baseEntity.getPosition(),e=this._tmpA.set(t.x,t.y+this.groundRayOffsetY,t.z),i=this._tmpB.set(t.x,t.y-this.groundRayLength,t.z),s=this.app.systems.rigidbody.raycastFirst(e,i);s?(this._groundNormal.lerp(this._groundNormal,s.normal,this.normalLerp),this._groundNormal.normalize(),this._haveGround=!0):this._haveGround=!1},Vehicle.prototype._projectOnPlane=function(t,e,i){var s=t.dot(e);i.copy(t).sub(this._tmpC.copy(e).scale(s));var r=i.length();return r>1e-4&&i.scale(1/r),i},Vehicle.prototype._stepAssist=function(t){var e=this.baseEntity.getPosition(),i=this.baseEntity.forward,s=this._tmpA.copy(i).scale(this.stepCheckDistance).add(e),r=this._tmpB.set(s.x,s.y+this.stepMaxHeight,s.z),a=this._tmpC.set(s.x,s.y-.05,s.z),n=this.app.systems.rigidbody.raycastFirst(r,a);if(n&&n.point&&n.normal){var l=n.normal.clone().normalize(),h=pc.math.clamp(1-pc.math.clamp(t/12,0,1),.15,1),o=l.scale(this.stepImpulse*h);this.rb.applyImpulse(o)}},Vehicle.prototype.update=function(t){if(this.rb){if(!this.controlsEnabled)return this.rb.linearVelocity&&this.rb.linearVelocity.set(0,0,0),void(this.rb.angularVelocity&&this.rb.angularVelocity.set(0,0,0));var e=this.app.keyboard.isPressed(pc.KEY_W)||this.app.keyboard.isPressed(pc.KEY_UP),i=this.app.keyboard.isPressed(pc.KEY_S)||this.app.keyboard.isPressed(pc.KEY_DOWN),s=this.app.keyboard.isPressed(pc.KEY_A)||this.app.keyboard.isPressed(pc.KEY_LEFT),r=this.app.keyboard.isPressed(pc.KEY_D)||this.app.keyboard.isPressed(pc.KEY_RIGHT),a=this.rb.linearVelocity.length(),n=Math.min(Math.max(a,this.minTurnVelocity),this.maxTurnVelocity);this._raycastGround();var l=this.baseEntity.forward.clone(),h=l.clone();if(this._haveGround?this._projectOnPlane(l,this._groundNormal,h):this.driveWhenAirborne?h.normalize():h.set(0,0,0),e&&this.rb.applyForce(h.clone().scale(this.speed)),i&&this.rb.applyForce(h.clone().scale(-this.speed)),this._haveGround&&this.extraDownforce>0){var o=this._groundNormal.clone().scale(-this.extraDownforce*this.rb.mass);this.rb.applyForce(o)}this._haveGround&&e&&this._stepAssist(a);var c=0,p=0;s?(p=this.turnSpeed*n,c=1):r?(p=-this.turnSpeed*n,c=-1):p=0,this.currentTurnSpeed=pc.math.lerp(this.currentTurnSpeed,p,.1);var d=2.5*this.currentTurnSpeed*n,u=new pc.Vec3(0,d,0);if("function"==typeof this.rb.setAngularVelocity)try{this.rb.setAngularVelocity(u)}catch(t){if(void 0!==this.rb.angularVelocity)this.rb.angularVelocity=u;else{var y=this.currentTurnSpeed*this.turnTorqueFactor*Math.max(n,1);this.rb.applyTorque(new pc.Vec3(0,y,0))}}else if(void 0!==this.rb.angularVelocity)this.rb.angularVelocity=u;else{y=this.currentTurnSpeed*this.turnTorqueFactor*Math.max(n,1);this.rb.applyTorque(new pc.Vec3(0,y,0))}this.chaseEntity&&this.chaseEntity.setLocalEulerAngles(0,0,5*this.currentTurnSpeed);var b=this.baseEntity.right.clone(),m=this.rb.linearVelocity.clone(),g=b.dot(m),f=b.scale(g).scale(-this.tireGrip*this.rb.mass);if(this.rb.applyForce(f),!e&&!i){var V=h.dot(m),E=h.clone().scale(V).scale(-this.brakeFactor*this.rb.mass);this.rb.applyForce(E)}if(this.rb.angularVelocity){var S=this.rb.angularVelocity.y;this.rb.applyTorque(new pc.Vec3(0,.6*-S*this.rb.mass,0))}if(this._sound){if(this.engineLoopSlot){var _=this._sound.slot(this.engineLoopSlot);if(_){var v=pc.math.clamp(a/this.maxEngineSpeed,0,1),D=pc.math.lerp(this.minEnginePitch,this.maxEnginePitch,v);_.pitch=D}}var k=(a-this.prevSpeed)/Math.max(t,1e-4);if(this.accelSlot){var x=this._sound.slot(this.accelSlot);x&&k>this.accelSensitivity&&(x.isPlaying||x.play())}if(this.decelSlot){var P=this._sound.slot(this.decelSlot);P&&k<-this.accelSensitivity&&(P.isPlaying||P.play())}}this.prevSpeed=a,this.wheels.forEach((function(t){t.fire("Vehicle:Velocity",a),t.fire("Vehicle:Turn",c)}))}};var Wheel=pc.createScript("wheel");Wheel.attributes.add("side",{type:"boolean",default:!0}),Wheel.attributes.add("front",{type:"boolean",default:!1}),Wheel.attributes.add("maxTurn",{type:"number",default:30}),Wheel.attributes.add("frameSpeed",{type:"number",default:30}),Wheel.prototype.initialize=function(){this.currentVelocity=0,this.currentTurnRotation=0,this.nextTurnRotation=0,this.currentStep=0,this.entity.on("Vehicle:Velocity",this.setVelocity,this),this.entity.on("Vehicle:Turn",this.setTurn,this),this.side||this.entity.setLocalScale(-1,1,1)},Wheel.prototype.setVelocity=function(t){this.currentVelocity=t},Wheel.prototype.setTurn=function(t){this.nextTurnRotation=t},Wheel.prototype.update=function(t){this.side?this.currentStep+=t*this.currentVelocity*this.frameSpeed:this.currentStep-=t*this.currentVelocity*this.frameSpeed,this.front&&(this.currentTurnRotation=pc.math.lerpAngle(this.currentTurnRotation,this.nextTurnRotation,.15)),this.entity.setLocalEulerAngles(this.currentStep,this.currentTurnRotation*this.maxTurn,0)};var Camera=pc.createScript("camera");Camera.attributes.add("vehicleEntity",{type:"entity"}),Camera.attributes.add("distance",{type:"number",default:6,title:"Follow Distance"}),Camera.attributes.add("height",{type:"number",default:2.5,title:"Camera Height"}),Camera.attributes.add("lookHeight",{type:"number",default:1.5,title:"Look Target Height"}),Camera.attributes.add("positionSmooth",{type:"number",default:5,title:"Position Smoothness"}),Camera.attributes.add("rotationSmooth",{type:"number",default:6,title:"Rotation Smoothness"}),Camera.attributes.add("sideOffset",{type:"number",default:0,title:"Side Offset"}),Camera.attributes.add("collisionOffset",{type:"number",default:.2,title:"Collision Offset"}),Camera.prototype.initialize=function(){this.targetPos=new pc.Vec3,this.desiredPos=new pc.Vec3,this.lookAtPos=new pc.Vec3,this.currentPos=this.entity.getPosition().clone(),this._tmp=new pc.Vec3,this._tmp2=new pc.Vec3,this._curRot=new pc.Quat,this._targetRot=new pc.Quat},Camera.prototype.update=function(t){if(this.vehicleEntity){var e=this.vehicleEntity,i=e.getPosition(),s=e.forward.clone().normalize(),o=e.right.clone().normalize();this.lookAtPos.copy(i),this.lookAtPos.y+=this.lookHeight,this.desiredPos.copy(i),this._tmp.copy(s).scale(-this.distance),this.desiredPos.add(this._tmp),this._tmp.copy(o).scale(this.sideOffset),this.desiredPos.add(this._tmp),this.desiredPos.y+=this.height;var a=this.app.systems.rigidbody.raycastFirst(this.lookAtPos,this.desiredPos);a&&a.entity!==e&&(this.desiredPos.copy(a.point),this._tmp.copy(a.normal).scale(this.collisionOffset),this.desiredPos.add(this._tmp));var r=1-Math.exp(-this.positionSmooth*t);this.currentPos.lerp(this.currentPos,this.desiredPos,r),this.entity.setPosition(this.currentPos),this._curRot.copy(this.entity.getRotation()),this.entity.lookAt(this.lookAtPos,pc.Vec3.UP),this._targetRot.copy(this.entity.getRotation()),this.entity.setRotation(this._curRot);var h=1-Math.exp(-this.rotationSmooth*t);this._curRot.slerp(this._curRot,this._targetRot,h),this.entity.setRotation(this._curRot)}};var UIScreen=pc.createScript("uiScreen");UIScreen.attributes.add("trashType",{type:"string",default:"paper"}),UIScreen.attributes.add("checkElement",{type:"entity"}),UIScreen.attributes.add("descriptionElement",{type:"entity"}),UIScreen.attributes.add("titleElement",{type:"entity"}),UIScreen.attributes.add("spriteElement",{type:"entity"}),UIScreen.prototype.initialize=function(){this.app.root.findByName("Base").sound.slot("engine").pitch=.5,this.hasAnswered=!1,this.isAnswerCorrect=!1,this.autoCloseTimer=-1,this.titleElement||(this.titleElement=this.entity.findByName("title")),this.descriptionElement||(this.descriptionElement=this.entity.findByName("description")),this.spriteElement||(this.spriteElement=this.entity.findByName("trashImage")),this.checkElement||(this.checkElement=this.entity.findByName("check")),this.checkElement&&(this.checkElement.enabled=!1),this.descriptionElement&&this.descriptionElement.element&&(this.descriptionElement.element.enabled=!1),this.setupDisposalButtons(),this.setupCloseButton(),this.app.keyboard.on("keydown",this.onKeyDown,this)},UIScreen.prototype.update=function(e){this.autoCloseTimer>0&&(this.autoCloseTimer-=e,this.autoCloseTimer<=0&&(this.autoCloseTimer=-1,this.closeScreen()))},UIScreen.prototype.setupCloseButton=function(){var e=this.entity.findByName("closeButton");e&&e.button&&(e.button.on("click",this.closeScreen,this),e.button.enabled=!1,e.enabled=!1)},UIScreen.prototype.setupDisposalButtons=function(){var e=this,t=[{name:"opt1Paper",type:"paper"},{name:"opt2Glass",type:"glass"},{name:"opt3Plastic",type:"plastic"},{name:"opt4Bio",type:"bio"},{name:"opt5EverydayTrash",type:"everyday-use-trash"}];this.disposalButtons=[];for(var n=0;n<t.length;n++){var s=t[n],i=e.entity.findByName(s.name);i&&i.button&&(i.trashType=s.type,i.button.on("click",e.onDisposalButtonClick,e),e.disposalButtons.push(i))}},UIScreen.prototype.onDisposalButtonClick=function(e){if(!this.hasAnswered){var t=null;if(e&&e.element&&e.element.entity?t=e.element.entity:e&&e.entity&&(t=e.entity),t){var n=t.trashType;this.hasAnswered=!0,this.isAnswerCorrect=n===this.trashType,this.showResult(),this.app.fire("trash:sorted",{type:this.trashType,isCorrect:this.isAnswerCorrect}),this.autoCloseTimer=3}else console.warn("UIScreen.onDisposalButtonClick: no button entity")}},UIScreen.prototype.showResult=function(){var e=new pc.Color(0,1,0,1),t=new pc.Color(1,0,0,1),n=this.isAnswerCorrect?e:t;if(this.checkElement&&(this.checkElement.enabled=!0,this.checkElement.element&&(this.checkElement.element.color=n)),this.descriptionElement&&this.descriptionElement.element&&(this.descriptionElement.element.enabled=!0,this.descriptionElement.element.color=n),this.disposalButtons)for(var s=0;s<this.disposalButtons.length;s++){var i=this.disposalButtons[s];i&&i.button&&(i.button.enabled=!1)}this.enableCloseButton()},UIScreen.prototype.enableCloseButton=function(){var e=this.entity.findByName("closeButton");e&&e.button&&(e.button.enabled=!0,e.enabled=!0)},UIScreen.prototype.onKeyDown=function(e){e.key===pc.KEY_ESCAPE&&this.entity.enabled&&this.hasAnswered&&this.closeScreen()},UIScreen.prototype.closeScreen=function(){this.entity.enabled=!1,this.resetUI(),this.app.fire("player:unlockControls")},UIScreen.prototype.resetUI=function(){this.hasAnswered=!1,this.isAnswerCorrect=!1,this.autoCloseTimer=-1,this.checkElement&&(this.checkElement.enabled=!1,this.checkElement.element&&(this.checkElement.element.color=new pc.Color(1,1,1,1))),this.descriptionElement&&this.descriptionElement.element&&(this.descriptionElement.element.enabled=!1,this.descriptionElement.element.color=new pc.Color(1,1,1,1));var e=this.entity.findByName("closeButton");if(e&&e.button&&(e.button.enabled=!1,e.enabled=!1),this.disposalButtons)for(var t=0;t<this.disposalButtons.length;t++){var n=this.disposalButtons[t];n&&n.button&&(n.button.enabled=!0)}},UIScreen.prototype.setTrashData=function(e,t,n,s){if(this.resetUI(),this.trashType=e||"paper",this.titleElement&&this.titleElement.element&&t&&(this.titleElement.element.text=t),this.descriptionElement&&this.descriptionElement.element&&n&&(this.descriptionElement.element.text=n,this.descriptionElement.element.enabled=!1,this.descriptionElement.element.color=new pc.Color(1,1,1,1)),this.spriteElement&&this.spriteElement.element&&s)try{this.spriteElement.element.textureAsset=s,this.spriteElement.element.enabled=!0}catch(e){console.error("UIScreen: failed to set image texture, check asset type is texture.",e)}},UIScreen.prototype.onDestroy=function(){this.app.keyboard.off("keydown",this.onKeyDown,this);var e=this.entity.findByName("closeButton");if(e&&e.button&&e.button.off("click",this.closeScreen,this),this.disposalButtons)for(var t=0;t<this.disposalButtons.length;t++){var n=this.disposalButtons[t];n&&n.button&&n.button.off("click",this.onDisposalButtonClick,this)}};var Collectible=pc.createScript("collectible");Collectible.attributes.add("trashType",{type:"string",default:"paper",enum:[{Paper:"paper"},{Glass:"glass"},{Plastic:"plastic"},{Bio:"bio"},{"Everyday Use Trash":"everyday-use-trash"}]}),Collectible.attributes.add("title",{type:"string",default:"Trash Item"}),Collectible.attributes.add("imageAsset",{type:"asset",assetType:"texture",description:"Texture image to show in UI image element"}),Collectible.attributes.add("description",{type:"string",default:"A piece of trash that needs proper disposal."}),Collectible.attributes.add("floatHeight",{type:"number",default:.5}),Collectible.attributes.add("floatSpeed",{type:"number",default:2}),Collectible.attributes.add("rotationSpeed",{type:"number",default:50}),Collectible.attributes.add("uiScreenEntity",{type:"entity",description:"Reference to the global UIScreen entity"}),Collectible.attributes.add("pickupSoundSource",{type:"entity",description:"Entity with Sound component and a pre-made pickup slot"}),Collectible.attributes.add("pickupSlotName",{type:"string",default:"pickup",description:"Name of the sound slot to play on pickupSoundSource"}),Collectible.prototype.initialize=function(){var t=this.entity.getPosition();this.originalY=t.y,this.time=0,this.isCollected=!1,this.entity.collision?this.entity.collision.on("triggerenter",this.onTriggerEnter,this):console.error("Collectible["+this.entity.name+"]: NO collision component."),this.uiScreenEntity||console.error("Collectible["+this.entity.name+"]: uiScreenEntity NOT assigned."),this.pickupSoundSource&&!this.pickupSoundSource.sound&&console.warn("Collectible["+this.entity.name+"]: pickupSoundSource has no sound component.")},Collectible.prototype.update=function(t){if(!this.isCollected){this.time+=t;var e=this.entity.getPosition(),i=this.originalY+Math.sin(this.time*this.floatSpeed)*this.floatHeight;this.entity.setPosition(e.x,i,e.z),this.entity.rotate(0,this.rotationSpeed*t,0)}},Collectible.prototype.onTriggerEnter=function(t){this.isCollected||this.collectItem()},Collectible.prototype.collectItem=function(){if(!this.isCollected){if(this.isCollected=!0,this.pickupSoundSource&&this.pickupSoundSource.sound)this.pickupSoundSource.sound.slot(this.pickupSlotName)?this.pickupSoundSource.sound.play(this.pickupSlotName):console.warn("Collectible["+this.entity.name+']: sound slot "'+this.pickupSlotName+'" not found on pickupSoundSource.');var t=this.entity.trashId||this.entity.getGuid();this.app.fire("trash:setCurrentItem",t),this.showUIScreen(),this.app.fire("trash:collected",{type:this.trashType,title:this.title,description:this.description}),this.entity.destroy()}},Collectible.prototype.showUIScreen=function(){if(this.uiScreenEntity){this.uiScreenEntity.enabled=!0;var t=this.uiScreenEntity.script&&this.uiScreenEntity.script.uiScreen;t?(t.setTrashData(this.trashType,this.title,this.description,this.imageAsset),this.app.fire("player:lockControls")):console.error("Collectible["+this.entity.name+']: UIScreen script "uiScreen" NOT found on UIScreen entity.')}else console.error("Collectible["+this.entity.name+"]: uiScreenEntity is null, cannot show UI.")};var FollowCamera=pc.createScript("followCamera");FollowCamera.attributes.add("target",{type:"entity",title:"Target",description:"The target entity to follow"}),FollowCamera.attributes.add("cameraOffset",{type:"vec3",default:[0,5,-10],title:"Camera Offset",description:"The local space offset with respect to the target entity coordinate system"}),FollowCamera.attributes.add("lerpAmount",{type:"number",min:0,max:1,default:.99,title:"Lerp Amount",description:"The amount to lerp the camera towards its desired position over time. The closer it is to 1, the faster the camera will move. Lerping is frame rate independent and will be correct for every frame rate."}),FollowCamera.prototype.initialize=function(){this.targetPos=new pc.Vec3,this.matrix=new pc.Mat4,this.quat=new pc.Quat,this.vec=new pc.Vec3,this.target?(this.updateTargetPosition(),this.currentPos=this.targetPos.clone()):this.currentPos=this.entity.getPosition().clone()},FollowCamera.prototype.updateTargetPosition=function(){var t=this.target.forward;this.vec.set(-t.x,0,-t.z).normalize();var e=180*Math.atan2(this.vec.x,this.vec.z)/Math.PI;this.quat.setFromEulerAngles(0,e,0),this.matrix.setTRS(this.target.getPosition(),this.quat,pc.Vec3.ONE),this.matrix.transformPoint(this.cameraOffset,this.targetPos)},FollowCamera.prototype.postUpdate=function(t){this.target&&(this.updateTargetPosition(),this.currentPos.lerp(this.currentPos,this.targetPos,1-Math.pow(1-this.lerpAmount,t)),this.entity.setPosition(this.currentPos),this.entity.lookAt(this.target.getPosition()))};var CarEngineSound=pc.createScript("carEngineSound");CarEngineSound.prototype.initialize=function(){},CarEngineSound.prototype.update=function(n){};var TrashManager=pc.createScript("trashManager");TrashManager.attributes.add("trashSpawnsParent",{type:"entity",description:"Parent entity with spawn point children"}),TrashManager.attributes.add("trashItemsParent",{type:"entity",description:"Parent entity with trash item prototype children"}),TrashManager.attributes.add("counterText",{type:"entity"}),TrashManager.attributes.add("trashCollectedText",{type:"entity"}),TrashManager.attributes.add("correctSortedText",{type:"entity"}),TrashManager.attributes.add("incorrectSortedText",{type:"entity"}),TrashManager.attributes.add("totalTrashToSpawn",{type:"number",default:10}),TrashManager.attributes.add("endSceneName",{type:"string",default:"EndGameScene"}),TrashManager.attributes.add("tutorialScreen",{type:"entity"}),TrashManager.attributes.add("tutorialCloseButton",{type:"entity"}),TrashManager.prototype.initialize=function(){this.resetStats(),this.spawnPoints=[],this.trashItemPrototypes=[],this.spawnedInstances=[],this.refreshSceneReferences(),this.app.on("trash:collected",this.onTrashCollected,this),this.app.on("trash:sorted",this.onTrashSorted,this),this.app.on("trash:newRound",this.startNewRound,this),this.startNewRound()},TrashManager.prototype.onDestroy=function(){this.app.off("trash:collected",this.onTrashCollected,this),this.app.off("trash:sorted",this.onTrashSorted,this),this.app.off("trash:newRound",this.startNewRound,this)},TrashManager.prototype.resetStats=function(){this.pickupCount=0,this.correctCount=0,this.incorrectCount=0,this.sortedCount=0,this.spawnedTrashCount=0},TrashManager.prototype.refreshSceneReferences=function(){if(this.trashSpawnsParent&&this.trashSpawnsParent.root||(this.trashSpawnsParent=this.app.root.findByName("TrashSpawns")),this.trashItemsParent&&this.trashItemsParent.root||(this.trashItemsParent=this.app.root.findByName("TrashItems")),this.spawnPoints=[],this.trashSpawnsParent?this.spawnPoints=this.trashSpawnsParent.children.slice(0):console.warn("TrashManager: trashSpawnsParent not found in this scene."),this.trashItemPrototypes=[],this.trashItemsParent){this.trashItemPrototypes=this.trashItemsParent.children.slice(0);for(var t=0;t<this.trashItemPrototypes.length;t++)this.trashItemPrototypes[t].enabled=!1}else console.warn("TrashManager: trashItemsParent not found in this scene.")},TrashManager.prototype.clearSpawnedInstances=function(){for(var t=0;t<this.spawnedInstances.length;t++){var e=this.spawnedInstances[t];e&&e.destroy&&e.destroy()}this.spawnedInstances=[]},TrashManager.prototype.startNewRound=function(){this.refreshSceneReferences(),this.clearSpawnedInstances(),this.resetStats(),this.spawnInitialTrash(),this.updateCounterText(),this.setupTutorial()},TrashManager.prototype.onTrashCollected=function(t){this.pickupCount++,this.updateCounterText()},TrashManager.prototype.onTrashSorted=function(t){t&&t.isCorrect?this.correctCount++:this.incorrectCount++,this.sortedCount++,this.updateCounterText();var e=this.spawnedTrashCount;this.sortedCount>=e&&e>0&&setTimeout((()=>{this.storeResultsAndEndGame()}),3e3)},TrashManager.prototype.updateCounterText=function(){var t=this.spawnedTrashCount||this.totalTrashToSpawn;this.counterText&&this.counterText.element&&(this.counterText.element.text=this.pickupCount+" / "+t),this.trashCollectedText&&this.trashCollectedText.element&&(this.trashCollectedText.element.text=this.pickupCount+" / "+t),this.correctSortedText&&this.correctSortedText.element&&(this.correctSortedText.element.text=this.correctCount.toString()),this.incorrectSortedText&&this.incorrectSortedText.element&&(this.incorrectSortedText.element.text=this.incorrectCount.toString())},TrashManager.prototype.spawnInitialTrash=function(){if(this.spawnPoints&&0!==this.spawnPoints.length)if(this.trashItemPrototypes&&0!==this.trashItemPrototypes.length){var t=Math.min(this.totalTrashToSpawn,this.spawnPoints.length,this.trashItemPrototypes.length);this.spawnedTrashCount=t;var e=this.spawnPoints.slice(0),s=this.trashItemPrototypes.slice(0);this._shuffleArray(e),this._shuffleArray(s);for(var r=0;r<t;r++){var a=e[r],n=s[r];if(a&&n){var o=n.clone();o.enabled=!0,o.setPosition(a.getPosition()),o.setRotation(a.getRotation()),this.spawnedInstances.push(o),this.app.root.addChild(o)}}this.updateCounterText()}else console.warn("TrashManager: no trash item prototypes in this scene.");else console.warn("TrashManager: no spawn points in this scene.")},TrashManager.prototype._shuffleArray=function(t){for(var e=t.length-1;e>0;e--){var s=Math.floor(Math.random()*(e+1)),r=t[e];t[e]=t[s],t[s]=r}},TrashManager.prototype.storeResultsAndEndGame=function(){this.app.trashStats={totalCollected:this.pickupCount,correct:this.correctCount,incorrect:this.incorrectCount},this.resetStats(),this.endGame()},TrashManager.prototype.endGame=function(){var t=this.app,e=this.endSceneName;console.log("TrashManager: all trash sorted, switching to scene:",e);var s=t.scenes.find(e);if(s){for(var r=s.url,a=t.root.children.slice(),n=0;n<a.length;n++){var o=a[n];o.tags&&o.tags.has("persistent")||o.destroy()}t.scenes.loadSceneHierarchy(r,(function(e,s){e?console.error("TrashManager: failed to load end scene hierarchy",e):t.scenes.loadSceneSettings(r,(function(t){t&&console.error("TrashManager: failed to load end scene settings",t)}))}))}else console.error('TrashManager: scene "'+e+'" not found.')},TrashManager.prototype.setupTutorial=function(){if(this.tutorialScreen){this.tutorialScreen.enabled=!0,this.app.fire("player:lockControls");var t=this.tutorialCloseButton||this.tutorialScreen.findByName("TutorialCloseButton");t&&t.button?(t.button.off("click",this.onTutorialClose,this),t.button.on("click",this.onTutorialClose,this)):console.warn("TrashManager: tutorial close button not found / missing button component.")}},TrashManager.prototype.onTutorialClose=function(){this.tutorialScreen&&(this.tutorialScreen.enabled=!1),this.app.fire("player:unlockControls");var t=this.tutorialCloseButton||this.tutorialScreen&&this.tutorialScreen.findByName("TutorialCloseButton");t&&t.button&&t.button.off("click",this.onTutorialClose,this)};var EndGameResults=pc.createScript("endGameResults");EndGameResults.attributes.add("resultText",{type:"entity",description:"Text element that displays the final result message"}),EndGameResults.attributes.add("resultText2",{type:"entity",description:"Secondary text element that displays the final result message"}),EndGameResults.prototype.initialize=function(){var t=this.app.trashStats||{},e=t.correct||0,s=e+(t.incorrect||0),i="";i=s<=0?"0/0.\nNeproti vēl šķirot atkritumus.":e<=4?e+"/"+s+".\nNeproti vēl šķirot atkritumus.":e<=7?e+"/"+s+".\nMazliet vēl jāatkārto.":e+"/"+s+".\nLabs darbs!",this.resultText&&this.resultText.element&&(this.resultText.element.text=i),this.resultText2&&this.resultText2.element&&(this.resultText2.element.text=i)};var ImageCarouselScreen=pc.createScript("imageCarouselScreen");ImageCarouselScreen.attributes.add("panelEntity",{type:"entity",description:"UI panel that shows the image + buttons"}),ImageCarouselScreen.attributes.add("imageElement",{type:"entity",description:"Element with image component"}),ImageCarouselScreen.attributes.add("images",{type:"asset",assetType:"texture",array:!0,description:"Textures to show in the carousel"}),ImageCarouselScreen.attributes.add("nextButton",{type:"entity"}),ImageCarouselScreen.attributes.add("prevButton",{type:"entity"}),ImageCarouselScreen.attributes.add("closeButton",{type:"entity"}),ImageCarouselScreen.attributes.add("clickSoundEntity",{type:"entity",description:"Entity with Sound component"}),ImageCarouselScreen.attributes.add("clickSoundSlot",{type:"string",default:"",description:"Sound slot name to play on click"}),ImageCarouselScreen.prototype.initialize=function(){this.currentIndex=0,this.panelEntity&&(this.panelEntity.enabled=!1),this.nextButton&&this.nextButton.button&&this.nextButton.button.on("click",this.onNext,this),this.prevButton&&this.prevButton.button&&this.prevButton.button.on("click",this.onPrev,this),this.closeButton&&this.closeButton.button&&this.closeButton.button.on("click",this.onClose,this)},ImageCarouselScreen.prototype.update=function(t){},ImageCarouselScreen.prototype.openCarousel=function(){this.panelEntity&&0!==this.images.length&&(this.currentIndex=pc.math.clamp(this.currentIndex,0,this.images.length-1),this._applyImage(),this.panelEntity.enabled=!0,this._playClickSound())},ImageCarouselScreen.prototype.onClose=function(){this.panelEntity&&(this.panelEntity.enabled=!1,this._playClickSound())},ImageCarouselScreen.prototype.onNext=function(){0!==this.images.length&&(this.currentIndex=(this.currentIndex+1)%this.images.length,this._applyImage(),this._playClickSound())},ImageCarouselScreen.prototype.onPrev=function(){0!==this.images.length&&(this.currentIndex=(this.currentIndex-1+this.images.length)%this.images.length,this._applyImage(),this._playClickSound())},ImageCarouselScreen.prototype._applyImage=function(){if(this.imageElement&&this.imageElement.element){var t=this.images[this.currentIndex];if(t)try{this.imageElement.element.textureAsset=t,this.imageElement.element.enabled=!0}catch(t){console.error("ImageCarouselScreen: failed to set textureAsset",t)}}},ImageCarouselScreen.prototype._playClickSound=function(){if(this.clickSoundEntity&&this.clickSoundSlot&&this.clickSoundEntity.sound){var t=this.clickSoundEntity.sound.slot(this.clickSoundSlot);t&&t.play()}};var OpenCarouselButton=pc.createScript("openCarouselButton");OpenCarouselButton.attributes.add("carouselEntity",{type:"entity",description:"Entity with imageCarouselScreen script"}),OpenCarouselButton.prototype.initialize=function(){this.entity.button?this.entity.button.on("click",this.onClick,this):console.warn("OpenCarouselButton: entity has no button component.")},OpenCarouselButton.prototype.onClick=function(){if(this.carouselEntity&&this.carouselEntity.script){var t=this.carouselEntity.script.imageCarouselScreen;t&&t.openCarousel&&t.openCarousel()}};var SceneButton=pc.createScript("sceneButton");SceneButton.attributes.add("sceneName",{type:"string",default:"",description:"Name of the scene to load (as in the editor)"}),SceneButton.attributes.add("startsNewTrashRound",{type:"boolean",default:!1,description:'If true, fires "trash:newRound" after loading this scene'}),SceneButton.prototype.initialize=function(){this.entity.button?this.entity.button.on("click",this.onClick,this):console.warn("SceneButton: entity has no button component.")},SceneButton.prototype.onClick=function(){this.sceneName?this.switchScene(this.sceneName):console.warn("SceneButton: sceneName not set.")},SceneButton.prototype.switchScene=function(t){var e=this.app,n=this,o=e.scenes.find(t);if(o){for(var s=o.url,i=e.root.children.slice(),c=0;c<i.length;c++){var r=i[c];r.tags&&r.tags.has("persistent")||r.destroy()}e.scenes.loadSceneHierarchy(s,(function(t,o){t?console.error("SceneButton: failed to load scene hierarchy",t):e.scenes.loadSceneSettings(s,(function(t){t&&console.error("SceneButton: failed to load scene settings",t),n.startsNewTrashRound&&e.fire("trash:newRound")}))}))}else console.error('SceneButton: scene "'+t+'" not found.')},SceneButton.prototype.onDestroy=function(){this.entity.button&&this.entity.button.off("click",this.onClick,this)};var MusicManager=pc.createScript("musicManager");MusicManager.prototype.initialize=function(){if(this.app.musicManagerInitialized)this.entity.destroy();else if(this.app.musicManagerInitialized=!0,this.entity.tags.has("persistent")||this.entity.tags.add("persistent"),this.entity.sound){var i=this.entity.sound.slot("music");i?i.isPlaying||this.entity.sound.play("music"):console.error('MusicManager: sound slot "music" not found.')}else console.error("MusicManager: no sound component on music entity.")};